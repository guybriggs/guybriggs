<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Prototype Flow</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Nunito from Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@600;700;900&display=swap" rel="stylesheet">

  <style>
    :root {
      --flatify__border-width: max(2px, 0.18em);
      --flatify__border-radius: 1em;
      --flatify__hover-brightness: 95%;
      --flatify__backdrop-opacity: 0.35;
      --flatify__max-font-size: 100%;
      --flatify__min-font-size: 85%;
      --flatify__primary-font-family: Nunito, sans-serif;
      --flatify__heading-font-family: Nunito, sans-serif;
      --flatify__code-font-family: Fira Code, Menlo, Monaco, Consolas, Liberation Mono, Courier New, monospace;
      --flatify__base-line-height: 1.5;
      --flatify__small-line-height: 1.2;
      --flatify__bold-font-weight: 700;
      --flatify__extra-bold-font-weight: 900;

      --flatify__bg-color: #ffffff;
      --flatify__bg-color-dark: #f1f4f7;
      --flatify__bg-color-darker: #ced9e3;

      --flatify__txt-color: #2e4051;
      --flatify__txt-color-inverted: #ffffff;

      --flatify__color-blue-primary: #1cb0f6;
      --flatify__color-blue-dark: #1896d1;

      --flatify__color-green-primary: #58cc02;
      --flatify__color-green-dark: #4bad02;

      --flatify__color-orange-primary: #ff9600;
      --flatify__color-orange-dark: #d98000;

      --flatify__color-purple-primary: #c164ff;
      --flatify__color-purple-dark: #a455d9;

      --flatify__color-red-primary: #ff4b4b;
      --flatify__color-red-dark: #d94040;

      --flatify__tap-highlight-color: transparent;
      --flatify__simple-transition: 0.15s ease-in-out;

      /* extra palette (used in waves/blocks) */
      --color-tournament-orange: #ff9e42;
      --color-tournament-orange-light: #fff2e6;
      --playconomics-blue: #3fb1c5;

      --color-iguana: rgb(221, 244, 255);
      --orange-med: #ffe5ce;
      --blue-med: #b5dfff;

      --flatify__submenu-bg-color: var(--flatify__bg-color);
      --flatify__submenu-txt-color: var(--flatify__txt-color);
      --flatify__submenu-border-color: var(--flatify__bg-color-darker);

      --flatify__dropdown-animation-show-duration: 300ms;
      --flatify__dropdown-animation-hide-duration: 200ms;
      --flatify__dropdown-animation-show: flatify-dropdown-show var(--flatify__dropdown-animation-show-duration)
        cubic-bezier(0.52, 0.42, 0.44, 1.44);
      --flatify__dropdown-animation-hide: flatify-dropdown-hide var(--flatify__dropdown-animation-hide-duration)
        cubic-bezier(0.52, 0.42, 0.44, 1.44) both;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }
    html, body { height: 100%; width: 100%; }
    body {
      font-family: var(--flatify__primary-font-family);
      color: var(--flatify__txt-color);
      background: var(--flatify__bg-color);
      -webkit-tap-highlight-color: var(--flatify__tap-highlight-color);
    }

    /* =========================
       BUTTONS
    ========================== */
    .ui.button {
      color: var(--flatify__txt-color-inverted);
      background: var(--flatify__bg-color-dark);
      border: none;
      line-height: var(--flatify__small-line-height);
      border-radius: var(--flatify__border-radius);
      box-shadow: inset 0 -0.25em 0 rgba(0,0,0,0.1)!important;

      position: relative;
      top: -0.25em;
      margin-top: 0.25em;

      padding: 9px 16px;
      font-size: 15px;
      font-weight: var(--flatify__bold-font-weight);

      cursor: pointer;
      transition: filter var(--flatify__simple-transition), transform var(--flatify__simple-transition);
      white-space: nowrap;
    }
    .ui.button:after { content: ""; display: block; height: 0.25em; }
    .ui.button:active { top: 0; margin-bottom: 0.25em; box-shadow: none!important; }
    .ui.button:active:after { display: none; }
    .ui.button:hover { filter: brightness(var(--flatify__hover-brightness)); }

    .ui.primary.button { background-color: var(--flatify__color-green-primary); }
    .ui.primary.button:hover,
    .ui.primary.button:focus { background-color: var(--flatify__color-green-dark); }

    .ui.secondary.button { background-color: var(--flatify__color-blue-primary); }
    .ui.secondary.button:hover,
    .ui.secondary.button:focus { background-color: var(--flatify__color-blue-dark); }

    /* "Pro" button styling */
    .ui.pro.button { background-color: var(--flatify__color-purple-primary); }
    .ui.pro.button:hover,
    .ui.pro.button:focus { background-color: var(--flatify__color-purple-dark); }

    /* =========================
       HEADER
    ========================== */
    .top-bar {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 64px;
      background: rgba(255,255,255,0.65);
      z-index: 10;
      backdrop-filter: blur(4px);
    }
    .top-bar-inner {
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 12px;
    }

    .nav-left, .nav-right { display: flex; align-items: center; }

    .tab-group { display: inline-flex; align-items: center; gap: 0; }
    .tab-group .ui.button { border-radius: 0; margin-left: 0; }
    .tab-group .ui.button:first-child {
      border-top-left-radius: var(--flatify__border-radius);
      border-bottom-left-radius: var(--flatify__border-radius);
    }
    .tab-group .ui.button:last-child {
      border-top-right-radius: var(--flatify__border-radius);
      border-bottom-right-radius: var(--flatify__border-radius);
    }

    /* =========================
       PAGES
    ========================== */
    .page { min-height: 100vh; padding-top: 64px; }
    .hidden { display: none !important; }

    .freeplay {
      height: calc(100vh - 64px);
      width: 100%;
      background: var(--flatify__color-blue-primary);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .course-page {
      background: white;
      min-height: calc(100vh - 64px);
      padding: 28px 16px 60px;
    }
    .container { max-width: 1080px; margin: 0 auto; }
    .block { width: 100%; margin: 16px 0; border-radius: 12px; }
    .orange { background: var(--orange-med); height: 120px; }
    .green  { background: var(--color-iguana); height: 220px; }
    .blue   { background: var(--blue-med); height: 160px; }
    .grey   { background: var(--flatify__bg-color-darker); height: 280px; }

    .waves-page {
      min-height: calc(100vh - 64px);
      position: relative;
      overflow: hidden;
    }
    .wave-layer {
      position: absolute;
      width: 120vw;
      height: 120%;
      top: -10%;
      left: -10vw;
      pointer-events: none;
    }
    .wave-layer svg { width: 100%; height: 100%; display: block; }
    .back { z-index: 1; }
    .front { z-index: 2; }

    /* =========================
       MODAL (base)
    ========================== */
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,var(--flatify__backdrop-opacity));
      backdrop-filter: blur(6px);
      z-index: 1000;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 16px;
      opacity: 0;
      pointer-events: none;
      transition: opacity var(--flatify__simple-transition);
    }
    .modal-overlay.open { opacity: 1; pointer-events: auto; }
    .modal {
      width: min(520px, 100%);
      background: #fff;
      color: var(--flatify__txt-color);
      border-radius: 16px;
      box-shadow: 0 18px 60px rgba(0,0,0,0.25);
      transform: translateY(8px) scale(0.99);
      transition: transform var(--flatify__simple-transition);
      overflow: hidden;
    }
    .modal-overlay.open .modal { transform: translateY(0) scale(1); }

    .modal-header {
      padding: 16px 16px 12px;
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      gap: 12px;
      border-bottom: 1px solid rgba(0,0,0,0.06);
    }
    .modal-title {
      font-weight: var(--flatify__extra-bold-font-weight);
      font-size: 18px;
      line-height: 1.2;
    }
    .modal-subtitle {
      margin-top: 6px;
      font-size: 13px;
      opacity: 0.8;
    }
    .icon-btn {
      background: transparent;
      border: none;
      cursor: pointer;
      font-size: 22px;
      line-height: 1;
      padding: 6px 10px;
      border-radius: 10px;
      color: var(--flatify__txt-color);
      transition: background var(--flatify__simple-transition);
    }
    .icon-btn:hover { background: rgba(0,0,0,0.06); }

    .modal-body { padding: 16px; }
    .modal-footer {
      padding: 14px 16px 16px;
      display: flex;
      gap: 10px;
      justify-content: space-between;
      align-items: center;
      border-top: 1px solid rgba(0,0,0,0.06);
      flex-wrap: wrap;
    }

    .left-actions, .right-actions {
      display: inline-flex;
      gap: 10px;
      align-items: center;
      flex-wrap: wrap;
    }

    .link-btn {
      background: transparent;
      border: none;
      cursor: pointer;
      color: var(--flatify__color-blue-dark);
      font-weight: var(--flatify__bold-font-weight);
      font-size: 13px;
      padding: 6px 8px;
      border-radius: 10px;
      transition: background var(--flatify__simple-transition);
    }
    .link-btn:hover { background: rgba(28,176,246,0.10); }

    .hint { font-size: 12px; opacity: 0.8; line-height: 1.3; }
    .centered { text-align: center; padding: 6px 4px 2px; }
    .big-check { font-size: 44px; line-height: 1; margin-bottom: 10px; }
    .muted { opacity: 0.75; font-size: 13px; line-height: 1.35; }

    .stepper {
      display: flex;
      gap: 8px;
      margin-bottom: 14px;
      align-items: center;
      flex-wrap: wrap;
    }
    .chip {
      background: var(--flatify__bg-color-dark);
      border: 1px solid var(--flatify__bg-color-darker);
      border-radius: 999px;
      padding: 6px 10px;
      font-size: 12px;
      font-weight: var(--flatify__bold-font-weight);
      opacity: 0.7;
    }
    .chip.active { opacity: 1; background: #fff; }
    .chip.done {
      opacity: 1;
      background: rgba(88, 204, 2, 0.12);
      border-color: rgba(88, 204, 2, 0.35);
    }

    .form { display: grid; gap: 12px; }
    .field label {
      display: block;
      font-size: 12px;
      font-weight: var(--flatify__bold-font-weight);
      margin-bottom: 6px;
      opacity: 0.9;
    }
    .field input {
      width: 100%;
      padding: 12px 12px;
      border-radius: 12px;
      border: 2px solid var(--flatify__bg-color-darker);
      background: #fff;
      font-size: 14px;
      outline: none;
      transition: border-color var(--flatify__simple-transition), filter var(--flatify__simple-transition);
      font-family: var(--flatify__primary-font-family);
      color: var(--flatify__txt-color);
    }
    .field input:focus {
      border-color: rgba(28,176,246,0.75);
      filter: brightness(99%);
    }

    /* =========================
       DROPDOWNS
    ========================== */
    @keyframes flatify-dropdown-show {
      from { opacity: 0; transform: scale(0.9); }
      to   { opacity: 1; transform: scale(1); }
    }
    @keyframes flatify-dropdown-hide {
      from { opacity: 1; transform: scale(1); }
      to   { opacity: 0; transform: scale(0.85); }
    }

    .flatify-dropdown-show { display: block; animation: var(--flatify__dropdown-animation-show); }
    .flatify-dropdown-will-be-hidden { animation: var(--flatify__dropdown-animation-hide); }

    .ui.dropdown { position: relative; display: inline-flex; align-items: center; }

    .ui.dropdown .menu {
      position: absolute;
      top: calc(100% + 10px);
      left: 0;
      z-index: 999;
      display: none;

      min-width: 12em;
      padding: 0.5em 0;

      color: var(--flatify__submenu-txt-color);
      background: var(--flatify__submenu-bg-color);
      border: var(--flatify__border-width) solid var(--flatify__submenu-border-color);
      border-radius: var(--flatify__border-radius);
      transform-origin: top left;
    }

    .ui.dropdown .menu > .item {
      width: 100%;
      display: block;
      text-align: left;
      background: transparent;
      border: none;
      cursor: pointer;

      padding: 12px 14px;
      font-family: var(--flatify__primary-font-family);
      font-weight: var(--flatify__bold-font-weight);
      text-transform: uppercase;
      font-size: 12px;
      letter-spacing: 0.04em;
      color: var(--flatify__txt-color);
    }
    .ui.dropdown .menu > .item:hover,
    .ui.dropdown .menu > .item:focus { background: var(--flatify__bg-color-dark); outline: none; }

    /* left trigger */
    .brand-trigger {
      appearance: none;
      border: none;
      background: transparent;
      cursor: pointer;
      font-family: var(--flatify__heading-font-family);
      font-weight: var(--flatify__extra-bold-font-weight);
      letter-spacing: 0.04em;
      color: var(--flatify__color-blue-primary);
      padding: 10px 10px;
      border-radius: 12px;
      line-height: 1;
      font-size: 15px;
    }
    .brand-trigger:hover { filter: brightness(var(--flatify__hover-brightness)); }
    .brand-trigger:focus { outline: none; box-shadow: 0 0 0 3px rgba(28,176,246,0.25); }
    .brand-inner { display: inline-flex; align-items: center; gap: 10px; }
    .hamburger { width: 18px; height: 14px; display: inline-flex; flex-direction: column; justify-content: space-between; }
    .hamburger span { display: block; height: 2px; width: 100%; background: currentColor; border-radius: 999px; opacity: 0.95; }

    /* avatar */
    .avatar-trigger {
      appearance: none;
      border: none;
      background: transparent;
      cursor: pointer;
      padding: 4px;
      border-radius: 999px;
      line-height: 0;
      transition: filter var(--flatify__simple-transition);
    }
    .avatar-trigger:hover { filter: brightness(var(--flatify__hover-brightness)); }
    .avatar-trigger:focus { outline: none; box-shadow: 0 0 0 3px rgba(28,176,246,0.25); }

    .avatar-img {
      width: 40px;
      height: 40px;
      border-radius: 999px;
      object-fit: cover;
      display: block;
      border: var(--flatify__border-width) solid var(--flatify__bg-color-darker);
      background: var(--flatify__bg-color-dark);
    }

    .ui.dropdown.righty .menu { left: auto; right: 0; transform-origin: top right; }

    /* =========================
       PROFILE MODAL CONTENT
    ========================== */
    .profile-header {
      display: flex;
      gap: 14px;
      align-items: center;
      padding: 2px 2px 8px;
    }
    .profile-avatar {
      width: 64px;
      height: 64px;
      border-radius: 999px;
      object-fit: cover;
      border: var(--flatify__border-width) solid var(--flatify__bg-color-darker);
      background: var(--flatify__bg-color-dark);
      flex: 0 0 auto;
    }
    .profile-names {
      display: grid;
      gap: 4px;
      min-width: 0;
    }
    .profile-fullname {
      font-weight: var(--flatify__extra-bold-font-weight);
      font-size: 18px;
      line-height: 1.2;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .profile-displayname {
      font-weight: var(--flatify__bold-font-weight);
      font-size: 13px;
      opacity: 0.8;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .profile-row {
      margin-top: 10px;
      display: grid;
      gap: 8px;
    }
    .kv {
      background: var(--flatify__bg-color-dark);
      border: 2px solid var(--flatify__bg-color-darker);
      border-radius: 14px;
      padding: 10px 12px;
      display: grid;
      gap: 2px;
    }
    .kv .k {
      font-size: 11px;
      font-weight: var(--flatify__bold-font-weight);
      letter-spacing: 0.04em;
      text-transform: uppercase;
      opacity: 0.75;
    }
    .kv .v {
      font-size: 14px;
      font-weight: var(--flatify__bold-font-weight);
      overflow-wrap: anywhere;
    }

    .profile-actions {
      display: grid;
      gap: 10px;
      width: 100%;
    }
    .profile-actions .ui.button {
      width: 100%;
      justify-content: center;
    }
  </style>
</head>

<body>
  <!-- HEADER -->
  <div class="top-bar">
    <div class="top-bar-inner container">
      <div class="nav-left">
        <div class="ui dropdown top left pointing" id="navDropdown">
          <button class="brand-trigger" id="navBrandBtn" type="button" aria-haspopup="true" aria-expanded="false">
            <span class="brand-inner">
              <span class="hamburger" aria-hidden="true">
                <span></span><span></span><span></span>
              </span>
              <span class="brand-text">PLAYCONOMICS</span>
            </span>
          </button>

          <div class="menu" id="navMenu" role="menu" aria-label="Primary navigation">
            <button class="item" type="button" data-page="freeplay">Freeplay</button>
            <button class="item" type="button" data-page="course">Course</button>
            <button class="item" type="button" data-page="about">About</button>
            <button class="item" type="button" data-page="tournaments">Tournaments</button>
            <button class="item" type="button" data-page="news">News</button>
          </div>
        </div>
      </div>

      <div class="nav-right">
        <!-- Default: show Login/Signup -->
        <div id="authArea" class="tab-group" aria-label="Authentication">
          <button class="ui primary button" id="btnLogin" type="button">Login</button>
          <button class="ui secondary button" id="btnSignup" type="button">Signup</button>
        </div>

        <!-- Default: avatar hidden -->
        <div class="ui dropdown righty hidden" id="userDropdown">
          <button class="avatar-trigger" id="avatarBtn" type="button" aria-haspopup="true" aria-expanded="false">
            <img class="avatar-img" id="headerAvatarImg" src="/avatar.png" alt="User avatar" />
          </button>

          <div class="menu" id="userMenu" role="menu" aria-label="User menu">
            <button class="item" type="button" data-user-action="profile">Profile</button>
            <button class="item" type="button" data-user-action="signout">Sign out</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- FREEPLAY -->
  <main class="page" id="pageFreeplay">
    <section class="freeplay">
      <button class="ui button" style="background-color: var(--flatify__color-green-primary);" id="playBtn">Play Game</button>
    </section>
  </main>

  <!-- COURSE -->
  <main class="page hidden" id="pageCourse">
    <section class="course-page">
      <div class="container">
        <div class="block orange"></div>
        <div class="block green"></div>
        <div class="block blue"></div>
        <div class="block grey"></div>
      </div>
    </section>
  </main>

  <!-- ABOUT -->
  <main class="page hidden" id="pageAbout">
    <section class="waves-page" style="background: var(--flatify__color-blue-dark);">
      <div class="wave-layer back">
        <svg viewBox="0 0 1440 800" preserveAspectRatio="none" aria-hidden="true">
          <path fill="var(--flatify__color-blue-primary)"
            d="M0,400 C240,300 480,600 720,450 C960,300 1200,200 1440,350 L1440,800 L0,800 Z"/>
          <path fill="var(--flatify__bg-color-darker)" opacity="0.45"
            d="M0,520 C220,620 460,420 700,490 C940,560 1080,700 1300,630 C1380,600 1420,570 1440,560 L1440,800 L0,800 Z"/>
        </svg>
      </div>
      <div class="wave-layer front">
        <svg viewBox="0 0 1440 800" preserveAspectRatio="none" aria-hidden="true">
          <path fill="var(--playconomics-blue)"
            d="M0,520 C260,420 520,640 780,520 C1040,400 1280,320 1440,420 L1440,800 L0,800 Z"/>
          <path fill="var(--flatify__color-green-primary)" opacity="0.55"
            d="M0,650 C260,720 520,540 760,610 C1000,680 1140,790 1340,720 C1400,690 1425,670 1440,660 L1440,800 L0,800 Z"/>
        </svg>
      </div>
    </section>
  </main>

  <!-- TOURNAMENTS -->
  <main class="page hidden" id="pageTournaments">
    <section class="waves-page" style="background: #1b2a3a;">
      <div class="wave-layer back">
        <svg viewBox="0 0 1440 800" preserveAspectRatio="none" aria-hidden="true">
          <path fill="#627a8f"
            d="M0,420 C260,300 520,600 780,480 C1040,360 1280,260 1440,360 L1440,800 L0,800 Z"/>
          <path fill="#3a5063" opacity="0.55"
            d="M0,540 C220,640 460,430 700,490 C940,550 1080,700 1300,630 C1380,600 1420,570 1440,560 L1440,800 L0,800 Z"/>
        </svg>
      </div>
      <div class="wave-layer front">
        <svg viewBox="0 0 1440 800" preserveAspectRatio="none" aria-hidden="true">
          <path fill="var(--color-tournament-orange)"
            d="M0,540 C260,440 520,660 780,540 C1040,420 1280,340 1440,440 L1440,800 L0,800 Z"/>
          <path fill="var(--color-tournament-orange-light)" opacity="0.9"
            d="M0,670 C260,740 520,560 760,630 C1000,700 1140,790 1340,730 C1400,700 1425,680 1440,670 L1440,800 L0,800 Z"/>
        </svg>
      </div>
    </section>
  </main>

  <!-- NEWS -->
  <main class="page hidden" id="pageNews">
    <section class="waves-page" style="background: #162433;">
      <div class="wave-layer back">
        <svg viewBox="0 0 1440 800" preserveAspectRatio="none" aria-hidden="true">
          <path fill="#5f6f89"
            d="M0,420 C240,300 480,620 720,480 C960,360 1200,260 1440,360 L1440,800 L0,800 Z"/>
          <path fill="#33485b" opacity="0.55"
            d="M0,540 C220,640 460,430 700,490 C940,550 1080,700 1300,630 C1380,600 1420,570 1440,560 L1440,800 L0,800 Z"/>
        </svg>
      </div>
      <div class="wave-layer front">
        <svg viewBox="0 0 1440 800" preserveAspectRatio="none" aria-hidden="true">
          <path fill="var(--flatify__color-blue-primary)"
            d="M0,560 C260,460 520,680 780,560 C1040,440 1280,360 1440,460 L1440,800 L0,800 Z"/>
          <path fill="var(--playconomics-blue)" opacity="0.65"
            d="M0,680 C260,750 520,570 760,640 C1000,710 1140,795 1340,735 C1400,705 1425,690 1440,680 L1440,800 L0,800 Z"/>
        </svg>
      </div>
    </section>
  </main>

  <!-- AUTH MODAL (LOGIN + SIGNUP) -->
  <div class="modal-overlay" id="authOverlay" role="dialog" aria-modal="true" aria-labelledby="authTitle" aria-hidden="true">
    <div class="modal" role="document">
      <div class="modal-header">
        <div>
          <div class="modal-title" id="authTitle">Welcome</div>
          <div class="modal-subtitle" id="authSubtitle">Prototype flow</div>
        </div>
        <button class="icon-btn" id="authCloseBtn" aria-label="Close" type="button">√ó</button>
      </div>

      <div class="modal-body">
        <div class="stepper" id="authStepper"></div>
        <div id="authContent"></div>
      </div>

      <div class="modal-footer">
        <div class="left-actions">
          <button class="link-btn" id="authBackBtn" type="button">Back</button>
          <button class="link-btn" id="authAltBtn" type="button">Use a different method</button>
        </div>
        <div class="right-actions">
          <button class="ui button secondary" id="authSecondaryBtn" type="button">Cancel</button>
          <button class="ui button primary" id="authPrimaryBtn" type="button">Continue</button>
        </div>
      </div>
    </div>
  </div>

  <!-- PROFILE MODAL -->
  <div class="modal-overlay" id="profileOverlay" role="dialog" aria-modal="true" aria-labelledby="profileTitle" aria-hidden="true">
    <div class="modal" role="document">
      <div class="modal-header">
        <div>
          <div class="modal-title" id="profileTitle">Profile</div>
          <div class="modal-subtitle" id="profileSubtitle">Account details</div>
        </div>
        <button class="icon-btn" id="profileCloseBtn" aria-label="Close" type="button">√ó</button>
      </div>

      <div class="modal-body" id="profileBody">
        <!-- injected -->
      </div>

      <div class="modal-footer">
        <div class="left-actions">
          <button class="link-btn" id="profileFooterClose" type="button">Close</button>
        </div>
        <div class="right-actions">
          <!-- empty by design -->
        </div>
      </div>
    </div>
  </div>

<script>
  /* =========================
     PAGES
  ========================== */
  const pages = {
    freeplay: document.getElementById("pageFreeplay"),
    course: document.getElementById("pageCourse"),
    about: document.getElementById("pageAbout"),
    tournaments: document.getElementById("pageTournaments"),
    news: document.getElementById("pageNews"),
  };

  const playBtn = document.getElementById("playBtn");

  function showPage(pageKey) {
    Object.values(pages).forEach(p => p.classList.add("hidden"));
    pages[pageKey].classList.remove("hidden");
    location.hash = pageKey;
  }

  const hash = (location.hash || "").replace("#", "").trim();
  if (hash && pages[hash]) showPage(hash);
  else showPage("freeplay");

  playBtn.addEventListener("click", () => alert("Play Game clicked"));

  /* =========================
     DROPDOWNS (ONE OPEN AT A TIME)
  ========================== */
  const navDropdown = document.getElementById("navDropdown");
  const navBrandBtn = document.getElementById("navBrandBtn");
  const navMenu = document.getElementById("navMenu");
  const navItems = Array.from(navMenu.querySelectorAll("[data-page]"));

  const authArea = document.getElementById("authArea");
  const userDropdown = document.getElementById("userDropdown");
  const avatarBtn = document.getElementById("avatarBtn");
  const userMenu = document.getElementById("userMenu");
  const userItems = Array.from(userMenu.querySelectorAll("[data-user-action]"));

  function isMenuOpen(menuEl) { return menuEl.classList.contains("flatify-dropdown-show"); }

  function hardHideMenu(menuEl, triggerBtn) {
    menuEl.classList.remove("flatify-dropdown-show", "flatify-dropdown-will-be-hidden");
    menuEl.style.display = "none";
    if (triggerBtn) triggerBtn.setAttribute("aria-expanded", "false");
  }

  function closeMenu(menuEl, triggerBtn) {
    if (!isMenuOpen(menuEl)) return;

    menuEl.classList.remove("flatify-dropdown-show");
    menuEl.classList.add("flatify-dropdown-will-be-hidden");
    if (triggerBtn) triggerBtn.setAttribute("aria-expanded", "false");

    const hideMs = 200;
    window.setTimeout(() => {
      menuEl.classList.remove("flatify-dropdown-will-be-hidden");
      menuEl.style.display = "none";
    }, hideMs);
  }

  function openMenu(menuEl, triggerBtn) {
    // ONLY ONE open: close the other menu immediately
    if (menuEl !== navMenu) hardHideMenu(navMenu, navBrandBtn);
    if (menuEl !== userMenu) hardHideMenu(userMenu, avatarBtn);

    menuEl.style.display = "block";
    menuEl.classList.remove("flatify-dropdown-will-be-hidden");
    menuEl.classList.add("flatify-dropdown-show");
    if (triggerBtn) triggerBtn.setAttribute("aria-expanded", "true");
  }

  function toggleMenu(menuEl, triggerBtn) {
    if (isMenuOpen(menuEl)) closeMenu(menuEl, triggerBtn);
    else openMenu(menuEl, triggerBtn);
  }

  navBrandBtn.addEventListener("click", (e) => {
    e.preventDefault();
    e.stopPropagation();
    toggleMenu(navMenu, navBrandBtn);
  });

  navItems.forEach(btn => {
    btn.addEventListener("click", (e) => {
      e.preventDefault();
      e.stopPropagation();
      showPage(btn.dataset.page);
      closeMenu(navMenu, navBrandBtn);
    });
  });

  avatarBtn.addEventListener("click", (e) => {
    e.preventDefault();
    e.stopPropagation();
    toggleMenu(userMenu, avatarBtn);
  });

  /* Outside click closes menus */
  document.addEventListener("click", (e) => {
    if (!navDropdown.contains(e.target)) closeMenu(navMenu, navBrandBtn);
    if (!userDropdown.contains(e.target)) closeMenu(userMenu, avatarBtn);
  });

  /* ESC closes menus; modals have their own ESC handlers */
  document.addEventListener("keydown", (e) => {
    if (e.key === "Escape") {
      closeMenu(navMenu, navBrandBtn);
      closeMenu(userMenu, avatarBtn);
    }
  });

  /* =========================
     AUTH UI SWAP (avatar hidden by default)
  ========================== */
  const headerAvatarImg = document.getElementById("headerAvatarImg");

  const state = {
    isLoggedIn: false,
    mode: "login", // "login" | "signup"
    step: 0,
    method: "email", // "email" | "otp"

    // user profile data (used by profile modal)
    user: {
      fullName: "Guy Briggs",
      displayName: "@guybriggs8278",
      email: "guybriggs8278@gmail.com",
      avatarUrl: "/avatar.png"
    },

    // Prefilled for login step
    data: {
      loginEmail: "guybriggs8278@gmail.com",
      loginPassword: "password123",

      email: "",
      password: "",
      name: "",
      otp: ""
    }
  };

  function setLoggedInUI(isLoggedIn) {
    state.isLoggedIn = isLoggedIn;
    if (isLoggedIn) {
      authArea.classList.add("hidden");
      userDropdown.classList.remove("hidden");
      headerAvatarImg.src = state.user.avatarUrl;

      hardHideMenu(userMenu, avatarBtn);
      hardHideMenu(navMenu, navBrandBtn);
    } else {
      userDropdown.classList.add("hidden");
      authArea.classList.remove("hidden");
      hardHideMenu(userMenu, avatarBtn);
    }
  }

  // Ensure correct default state on load
  setLoggedInUI(false);

  /* =========================
     AUTH MODAL (LOGIN + SIGNUP)
  ========================== */
  const authOverlay = document.getElementById("authOverlay");
  const authCloseBtn = document.getElementById("authCloseBtn");

  const authTitle = document.getElementById("authTitle");
  const authSubtitle = document.getElementById("authSubtitle");
  const authStepper = document.getElementById("authStepper");
  const authContent = document.getElementById("authContent");

  const authBackBtn = document.getElementById("authBackBtn");
  const authAltBtn = document.getElementById("authAltBtn");
  const authSecondaryBtn = document.getElementById("authSecondaryBtn");
  const authPrimaryBtn = document.getElementById("authPrimaryBtn");

  const btnLogin = document.getElementById("btnLogin");
  const btnSignup = document.getElementById("btnSignup");

  const flows = {
    login: [
      { key: "credentials", label: "Login" }
    ],
    signup: [
      { key: "welcome", label: "Welcome" },
      { key: "details", label: "Details" },
      { key: "verify", label: "Verify" },
      { key: "done", label: "Done" }
    ]
  };

  function getFlow() { return flows[state.mode]; }
  function currentStepDef() { return getFlow()[state.step]; }

  function openAuth(mode) {
    // close menus (one thing at a time)
    hardHideMenu(navMenu, navBrandBtn);
    hardHideMenu(userMenu, avatarBtn);

    state.mode = mode;
    state.step = 0;

    // Prefill login every time you open it
    if (mode === "login") {
      state.method = "email";
      state.data.loginEmail = state.user.email;
      state.data.loginPassword = "password123";
    } else {
      state.method = "email";
    }

    authOverlay.classList.add("open");
    authOverlay.setAttribute("aria-hidden", "false");
    document.body.style.overflow = "hidden";
    renderAuth();
    setTimeout(() => authPrimaryBtn.focus(), 0);
  }

  function closeAuth() {
    authOverlay.classList.remove("open");
    authOverlay.setAttribute("aria-hidden", "true");
    document.body.style.overflow = "";
  }

  function setPrimary(text, kind) {
    authPrimaryBtn.textContent = text;
    authPrimaryBtn.classList.remove("primary", "secondary", "pro");
    authPrimaryBtn.classList.add(kind || "primary");
  }

  function setSecondary(text, show) {
    authSecondaryBtn.textContent = text || "Cancel";
    authSecondaryBtn.style.display = show === false ? "none" : "";
  }

  function setBack(show) { authBackBtn.style.display = show ? "" : "none"; }
  function setAlt(show, text) {
    authAltBtn.style.display = show ? "" : "none";
    if (text) authAltBtn.textContent = text;
  }

  function renderStepper() {
    const flow = getFlow();
    const activeIndex = state.step;
    authStepper.innerHTML = "";

    flow.forEach((s, idx) => {
      const chip = document.createElement("div");
      chip.className = "chip";
      chip.textContent = s.label;
      if (idx < activeIndex) chip.classList.add("done");
      if (idx === activeIndex) chip.classList.add("active");
      authStepper.appendChild(chip);
    });
  }

  function field(label, type, value, onInput, opts = {}) {
    const wrap = document.createElement("div");
    wrap.className = "field";

    const lab = document.createElement("label");
    lab.textContent = label;

    const input = document.createElement("input");
    input.type = type;
    input.value = value || "";
    if (opts.placeholder) input.placeholder = opts.placeholder;
    if (opts.autocomplete) input.autocomplete = opts.autocomplete;

    input.addEventListener("input", (e) => onInput(e.target.value));
    if (opts.onEnter) input.addEventListener("keydown", (e) => { if (e.key === "Enter") opts.onEnter(); });

    wrap.appendChild(lab);
    wrap.appendChild(input);
    return wrap;
  }

  function validateStep() {
    const def = currentStepDef();
    const d = state.data;
    if (!def) return true;

    if (state.mode === "login") {
      if (def.key === "credentials") return !!d.loginEmail.trim() && !!d.loginPassword.trim();
      return true;
    }

    if (def.key === "welcome") return true;
    if (def.key === "details") return !!d.name.trim() && !!d.email.trim();
    if (def.key === "verify") return (state.method === "otp") ? !!d.otp.trim() : !!d.password.trim();
    return true;
  }

  function nextStep() {
    if (!validateStep()) {
      authSubtitle.textContent = "Please complete the fields to continue.";
      authSubtitle.style.color = "var(--flatify__color-red-dark)";
      setTimeout(() => {
        authSubtitle.style.color = "";
        authSubtitle.textContent = "Prototype flow";
      }, 900);
      return;
    }

    if (state.mode === "login") {
      // "submit" login -> show avatar + close modal
      closeAuth();
      setLoggedInUI(true);
      return;
    }

    const flow = getFlow();
    if (state.step < flow.length - 1) state.step += 1;
    renderAuth();
  }

  function prevStep() {
    if (state.step > 0) state.step -= 1;
    renderAuth();
  }

  function switchMethod() {
    state.method = state.method === "email" ? "otp" : "email";
    renderAuth();
  }

  function renderLoginStep(def) {
    authTitle.textContent = "Log in";
    authSubtitle.textContent = "Prefilled ‚Äî just hit Sign in.";

    const form = document.createElement("div");
    form.className = "form";

    form.appendChild(field(
      "Email",
      "email",
      state.data.loginEmail,
      v => state.data.loginEmail = v,
      { placeholder: "name@example.com", autocomplete: "email", onEnter: nextStep }
    ));

    form.appendChild(field(
      "Password",
      "password",
      state.data.loginPassword,
      v => state.data.loginPassword = v,
      { placeholder: "‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢", autocomplete: "current-password", onEnter: nextStep }
    ));

    const hint = document.createElement("div");
    hint.className = "hint";
    hint.textContent = "Prototype only ‚Äî no real auth.";
    form.appendChild(hint);

    authContent.innerHTML = "";
    authContent.appendChild(form);

    setBack(false);
    setAlt(false);
    setSecondary("Cancel", true);
    setPrimary("Sign in", "primary");
  }

  function renderSignupStep(def) {
    authTitle.textContent = "Create account";
    authSubtitle.textContent = "Prototype flow";

    const form = document.createElement("div");
    form.className = "form";

    if (def.key === "welcome") {
      const box = document.createElement("div");
      box.className = "centered";
      box.innerHTML = `
        <div style="font-weight: 900; font-size: 16px; margin-bottom: 8px;">Welcome!</div>
        <div class="muted">You‚Äôll enter details, verify, and finish setup.</div>
      `;
      form.appendChild(box);
    }

    if (def.key === "details") {
      form.appendChild(field(
        "Name",
        "text",
        state.data.name,
        v => state.data.name = v,
        { placeholder: "Your name", autocomplete: "name", onEnter: nextStep }
      ));
      form.appendChild(field(
        "Email",
        "email",
        state.data.email,
        v => state.data.email = v,
        { placeholder: "name@example.com", autocomplete: "email", onEnter: nextStep }
      ));

      const hint = document.createElement("div");
      hint.className = "hint";
      hint.textContent = "Next you‚Äôll verify your account.";
      form.appendChild(hint);
    }

    if (def.key === "verify") {
      if (state.method === "otp") {
        authSubtitle.textContent = "We sent you a code. Enter it to verify.";
        form.appendChild(field(
          "Verification code",
          "text",
          state.data.otp,
          v => state.data.otp = v.replace(/\D/g, "").slice(0, 6),
          { placeholder: "123456", autocomplete: "one-time-code", onEnter: nextStep }
        ));
      } else {
        authSubtitle.textContent = "Set a password to secure your account.";
        form.appendChild(field(
          "Password",
          "password",
          state.data.password,
          v => state.data.password = v,
          { placeholder: "Create a password", autocomplete: "new-password", onEnter: nextStep }
        ));
      }

      const hint = document.createElement("div");
      hint.className = "hint";
      hint.textContent = state.method === "otp"
        ? "Prototype code: type any 6 digits."
        : "Prototype password: type anything.";
      form.appendChild(hint);
    }

    if (def.key === "done") {
      const box = document.createElement("div");
      box.className = "centered";
      box.innerHTML = `
        <div class="big-check">üéâ</div>
        <div style="font-weight: 900; font-size: 16px; margin-bottom: 6px;">Account created</div>
        <div class="muted">You‚Äôre all set (prototype).</div>
      `;
      form.appendChild(box);
    }

    authContent.innerHTML = "";
    authContent.appendChild(form);

    setBack(state.step > 0);
    setSecondary("Cancel", true);

    if (def.key === "welcome") {
      setBack(false);
      setPrimary("Get started", "primary");
      setAlt(false);
    } else if (def.key === "details") {
      setPrimary("Continue", "primary");
      setAlt(false);
    } else if (def.key === "verify") {
      setPrimary(state.method === "otp" ? "Verify account" : "Create account", "primary");
      setAlt(true, state.method === "otp" ? "Set password instead" : "Verify with code");
    } else if (def.key === "done") {
      setBack(false);
      setAlt(false);
      setSecondary("Close", true);
      setPrimary("Go to Course", "secondary");
    }
  }

  function renderAuth() {
    renderStepper();
    const def = currentStepDef();
    if (state.mode === "login") renderLoginStep(def);
    else renderSignupStep(def);
  }

  btnLogin.addEventListener("click", () => openAuth("login"));
  btnSignup.addEventListener("click", () => openAuth("signup"));

  authCloseBtn.addEventListener("click", closeAuth);
  authSecondaryBtn.addEventListener("click", closeAuth);
  authOverlay.addEventListener("click", (e) => { if (e.target === authOverlay) closeAuth(); });
  document.addEventListener("keydown", (e) => { if (e.key === "Escape") closeAuth(); });

  authPrimaryBtn.addEventListener("click", () => {
    const def = currentStepDef();
    if (state.mode === "signup" && def && def.key === "done") {
      closeAuth();
      showPage("course");
      return;
    }
    nextStep();
  });

  authBackBtn.addEventListener("click", prevStep);

  authAltBtn.addEventListener("click", () => {
    const def = currentStepDef();
    if (!def) return;
    if (state.mode === "signup" && def.key === "verify") switchMethod();
  });

  /* =========================
     PROFILE MODAL
  ========================== */
  const profileOverlay = document.getElementById("profileOverlay");
  const profileCloseBtn = document.getElementById("profileCloseBtn");
  const profileFooterClose = document.getElementById("profileFooterClose");
  const profileBody = document.getElementById("profileBody");

  function openProfileModal() {
    // close dropdowns so only one thing is active
    hardHideMenu(navMenu, navBrandBtn);
    hardHideMenu(userMenu, avatarBtn);

    const u = state.user;

    profileBody.innerHTML = `
      <div class="profile-header">
        <img class="profile-avatar" src="${u.avatarUrl}" alt="Profile avatar" />
        <div class="profile-names">
          <div class="profile-fullname" title="${u.fullName}">${u.fullName}</div>
          <div class="profile-displayname" title="${u.displayName}">${u.displayName}</div>
        </div>
      </div>

      <div class="profile-row">
        <div class="kv">
          <div class="k">Email</div>
          <div class="v">${u.email}</div>
        </div>
      </div>

      <div class="profile-row profile-actions" style="margin-top: 14px;">
        <button class="ui button secondary" id="btnCustomizeAvatar" type="button">Customise avatar</button>
        <button class="ui button secondary" id="btnResetPassword" type="button">Reset password</button>
        <button class="ui button pro" id="btnPurchasePro" type="button">Purchase ‚ÄúPro-conomics‚Äù</button>
      </div>
    `;

    // wire buttons (prototype actions)
    const btnCustomizeAvatar = document.getElementById("btnCustomizeAvatar");
    const btnResetPassword = document.getElementById("btnResetPassword");
    const btnPurchasePro = document.getElementById("btnPurchasePro");

    btnCustomizeAvatar.addEventListener("click", () => alert("Customise avatar clicked"));
    btnResetPassword.addEventListener("click", () => alert("Reset password clicked"));
    btnPurchasePro.addEventListener("click", () => alert("Purchase Pro-conomics clicked"));

    profileOverlay.classList.add("open");
    profileOverlay.setAttribute("aria-hidden", "false");
    document.body.style.overflow = "hidden";
    setTimeout(() => profileCloseBtn.focus(), 0);
  }

  function closeProfileModal() {
    profileOverlay.classList.remove("open");
    profileOverlay.setAttribute("aria-hidden", "true");
    document.body.style.overflow = "";
  }

  profileCloseBtn.addEventListener("click", closeProfileModal);
  profileFooterClose.addEventListener("click", closeProfileModal);
  profileOverlay.addEventListener("click", (e) => { if (e.target === profileOverlay) closeProfileModal(); });
  document.addEventListener("keydown", (e) => { if (e.key === "Escape") closeProfileModal(); });

  /* Hook profile click in user menu */
  userItems.forEach(btn => {
    btn.addEventListener("click", (e) => {
      e.preventDefault();
      e.stopPropagation();
      const action = btn.dataset.userAction;

      if (action === "profile") {
        closeMenu(userMenu, avatarBtn);
        openProfileModal();
        return;
      }

      if (action === "signout") {
        setLoggedInUI(false);
        hardHideMenu(userMenu, avatarBtn);
        showPage("freeplay");
        return;
      }
    });
  });
</script>

</body>
</html>
